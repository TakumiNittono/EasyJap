# 採点基準の説明

## 現在の採点システム

### 総合スコア: 100点満点

採点は以下の3つの要素で構成されています：

---

## 1. 筆順スコア（40点満点）

各画を10点満点で評価し、最大40点まで加算されます。

### 評価項目

- **開始点の正確性**（-3点/画）
  - 正しい開始点から±10ピクセル以内: 減点なし
  - ±10ピクセル以上ずれている: -3点

- **終了点の正確性**（-3点/画）
  - 正しい終了点から±10ピクセル以内: 減点なし
  - ±10ピクセル以上ずれている: -3点

- **画の順序**（-5点/画）
  - 正しい順序で描画: 減点なし
  - 順序が間違っている: -5点

### 計算例
- 3画の文字の場合、各画10点×3画 = 最大30点
- 4画の文字の場合、各画10点×4画 = 最大40点（上限）

---

## 2. 形の正確性スコア（30点満点）

### 評価項目

- **バウンディングボックスの比較**（10点）
  - 文字全体の幅と高さの比率を比較
  - 正しいサイズとの一致度で評価

- **各画の長さの比較**（10点）
  - 各画の長さを正しい長さと比較
  - 全画の平均一致度で評価

- **画の角度の比較**（10点）
  - 各画の角度を正しい角度と比較
  - 全画の平均一致度で評価

---

## 3. バランス・美しさスコア（30点満点）

### 評価項目

- **中心位置の正確性**（10点）
  - 文字の中心位置が正しい位置にあるか
  - 中心からの距離で評価

- **画のバランス**（10点）
  - 現在は簡易実装で基本点5点を付与
  - TODO: より詳細なバランス評価を実装予定

- **間隔の均等性**（10点）
  - 現在は簡易実装で基本点5点を付与
  - TODO: より詳細な間隔評価を実装予定

---

## 現在の問題点

### ⚠️ 座標系の不一致

**問題**: 
- 正しい筆順データは300x300の座標系で定義されている
- ユーザーの描画はキャンバスの実際のサイズ（例: 600x600ピクセル）で記録されている
- このまま比較すると、座標が一致せず正確な採点ができない

**影響**:
- 筆順スコアが正確に計算されない可能性
- 開始点・終了点の判定が誤る可能性

### 改善が必要な点

1. **座標変換の実装**
   - ユーザーの描画座標を300x300の座標系に変換してから比較

2. **バランス・美しさスコアの実装**
   - 現在は基本点のみで、実際の評価が行われていない

3. **許容誤差の調整**
   - 現在10ピクセル固定だが、スケールに応じて調整が必要

---

## 改善案

### 座標変換の実装

```typescript
// ユーザーの描画座標を正規化（300x300座標系に変換）
function normalizeUserPoints(
  userPoints: Point[],
  canvasWidth: number,
  canvasHeight: number
): Point[] {
  const scale = Math.min(canvasWidth, canvasHeight) / 300;
  const offsetX = (canvasWidth - 300 * scale) / 2;
  const offsetY = (canvasHeight - 300 * scale) / 2;
  
  return userPoints.map(point => ({
    x: (point.x - offsetX) / scale,
    y: (point.y - offsetY) / scale,
  }));
}
```

この改善により、正確な採点が可能になります。


